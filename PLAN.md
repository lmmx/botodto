# Planning document

## Mission statement

The goal of this library is to wrap `boto3` clients so that all calls to AWS APIs through them
are ingested into, and emit responses as Pydantic models.

## Implementation

OpenAPI schemas are produced from the AWS Javascript SDK (v2)
[in the OpenAPI Directory](https://github.com/APIs-guru/openapi-directory/tree/master/APIs/amazonaws.com)
by [the `aws2openapi` tool](https://github.com/APIs-guru/aws2openapi).

These can be used to produce reliable Pydantic data models using [`datamodel-code-generator`][dcg]
(_to clarify_: with minimal? no? manual editing of the result).

[dcg]: datamodel-code-generator "https://github.com/koxudaxi/datamodel-code-generator"

My implementation will take one of the following routes [_TBD_]:

- [ ] replaces the `aws2openapi` tool with a Python converter for the v3 SDK (simplest approach, more work?)
  - Theoretically this is the nicest approach
  - It isn't a good idea to approach this without a proof of concept that the proposed solution is viable

- [ ] adds the OpenAPI schema (components) generated by `aws2openapi` from the v2 SDK to include exceptions from the v3 SDK
  - This could be a neat solution, it might be easier to write OpenAPI spec YAML than Pydantic models
  - In fact some of these components are already present in the v2 schema but have empty definitions.
    I think this is because they're referenced (in paths' associated operations) but had no structure declared,
    so they are included as 'stubs'.

- [x] amends the Pydantic models to include exceptions from the v3 SDK
  - This could be a simple proof of concept, least work to confirm a positive result?

The 1st approach would be self-contained but would mean maintaining an upgrade of a service I'm
unfamiliar with (which I suspect would introduce bugs).

Both the 2nd and 3rd approaches will require a mapping exercise between the v2 and v3 schemas.

I propose to start with the latter approach, for a single service, AWS Step Functions/v2 `states`/v3 `sfn`, and don't focus on the other services.
After this is shown to work, automate the process for the other services.

## Reliability

- I will use a test suite to check the results work for all schemas (there are a lot!)

- I would like to avoid manual data transfer or generation where possible to make this repeatable,
  and not deteriorate after writing.

## Phase 1: add v3 SDK shape definitions missing from (or empty in) the v2 SDK OpenAPI schema components generated by `aws2openapi`

1) Map the v2 and v3 services together.
- Initially we can use a dict `v2_to_v3` as simple as `{"states": "sfn"}`, but really it ought be data-derived.

2) Besides components present in the v2 schema but with empty definitions (e.g. `InvalidArn`), are there any missing from the v2 schema entirely?
- I suspect this is a contradiction, and presumably if we are to add definitions into the v2
  schema, they must already be 'known' in that schema, so would all be empty rather than missing.
- This should be easy to confirm.
